# Over view
Using **nmap -h** or **man nmap** to open the help menu for nmap

# Scan Types
There are 3 basic scan types:
- TCP connect scans (-sT)
- SYN "Half-open" scans (-sS)
- UDP scans (-sU)

There are several less common port scan types:
- TCP null scans (-sN)
- TCP FIN scans (-sF)
- TCP xmas scans (-sX)

___

### TCP Connect Scans (-sT)
TCP connect scan works by performing the three-way handshake with each target port in turn. Nmap tries to connect to each specified TCP port, and determines whether the services is open by the respone it receives.

* If the port is open: SYN -> SYN/ACK -> ACK

* If the port is closed: SYN -> RST (reset)

* But if the port is hidden behind a firewall: Nmap sends a TCP SYN request, and receives nothing back. Many firewalls are configured to simply *drop* incoming packets. The port is considered to be *filtered*.

But it's very easy to configure a firewall to respond with a RST TCP packet. This can make it extremely difficult to get an accurate reading of the target (if not possible).

___

### SYN Scans (-sS)
As with TCP scans, but SYN scan works sightly different. SYN scan are sometimes reffered to as "half-open" or "stealth" scans.

When TCP scan perform a full three-way handshaking, SYN scan sends back a RST TCP packet after receiving a SYN/ACK from the server. Preventing the server from repeatedly trying to make the request. 

Adventages:
- Bypassing other Intrusion Detection system
- Often not logged by applications listening on open ports.
- Faster - don't need to bother about completing the three-way hanshaking.

Disadventages:
- Require sudo permissions.
- Unstable services are sometimes brought down by the SYN scans. So problematic if the client provided a production enviroment for the test.

It all depends sudo permissions, you can choose TCP or SYN scan. The exact same rules as with TCP connect.

___

### UDP Scans (-sU)
UDP connections are stateless. UDP connections rely on sending packets to a target port and hoping that they make it. So the lack of acknowledgement makes UDP more difficult to scan -> much slower.

* If the port is open: there should not be response. Nmap refers to the port as being **open|filtered**. But it could be firewall.
If it gets a UDP respone (unusual) => marked as *open*.
Commonly no respone, sent a second time as a double-check. Still no respone => marked **opne|filtered**

* If the port is close: the target should respond with an ICMP (ping) packet cotaining a message that port is unreachable.

- **Basic syntax:** nmap -sU --top-ports 20 *target* : scan the top 20 most commonly used UDP ports
=> Saving time, because UDP is hard to indentify whether a UDP connect actually is open.

___
### NULL, FIN and Xmas TCP port scans

All three are interlinked and are used primarily as they tend to be even stealthier, relative speaking than a SYN stealth can.

**1. NULL (-sN)**
When the TCP request is sent with no flags set at all. RFC - the target host should respond with a RST if the port is closed. 

![NULL](https://i.imgur.com/ABCxAwf.png)

**2. FIN (-sF)**
Instead of sending with a empty packet, a request is sent with a FIN flag - close an active connection. Nmap expects a RST if the port is closed.

![FIN](https://i.imgur.com/gIzKbEk.png)

**3. Xmas scan (-sX)**
Sending a malformed TCP packet (không đúng định dạng) and expects a RST respone for closed ports. It's reffered to as (được gọi là) an xmas scan, because the apperance of a blinking xmas tree when the flag it sets (PSH, URG, FIN).

![xmas](https://i.imgur.com/gKVkGug.png)

___
The expected respone for open ports with these scan is also identical (giống hệt nhau) and very similar to that of an UDP scan.
- The port is open: no respone to the malformed packet.
- If the port is protected by a firewall: just marked *open|filtered, closed or filtered*.
- The port is identified as filtered: the target has responed with an ICMP packet.

While RFC 793 mandates that network host respond to malformed packet with a RST TCP packet for closed ports. In particular Microsoft Windows (Ciso network device) are known to respond with a RST to any malformed => This results in all ports showing up as being closed.

The goal is firewall evasion. Many firewall are configured to drop incoming TCP packet block ports which have the SYN set. By sending requests which don't contain the SYN flag, we effectively bypass this kind of firewall. Whilst is good in theory.

___
### ICMP Network Scanning 
Our first objective is to obtain a "map" of the network structure -- in other words, we want to see which IP addresses contain active hosts and which do not.

Using "ping sweep" in Nmap. Nmap sends an ICMP packet to each possible IP address for the specified network. When it receives a respone, it marks the IP address that responded as being alive. 

**Basic Syntax:** -sn with IP ranges 
'nmap -sn 192.168.0.1-254' || 'nmap -sn 192.168.0.0/24'
